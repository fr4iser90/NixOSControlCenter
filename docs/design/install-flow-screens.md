# Install Flow: Alle Screens Visualisiert

## ğŸ“º SCREEN 1: Installation Type Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Choose installation method                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ ğŸ“¦ Presets                                                â”‚
â”‚    ğŸ”§ Custom Install                                          â”‚
â”‚    âš™ï¸  Advanced Options                                       â”‚
â”‚                                                              â”‚
â”‚  [Preview Window rechts]                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ Desktop                  â”‚                                â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                                â”‚
â”‚  â”‚                          â”‚                                â”‚
â”‚  â”‚ Base desktop environment â”‚                                â”‚
â”‚  â”‚ with GUI (Plasma)...     â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Navigation: â†‘â†“ zum Navigieren, Enter zum BestÃ¤tigen, Space fÃ¼r Preview
```

---

## ğŸ“º SCREEN 2A: Preset Selection (wenn "ğŸ“¦ Presets" gewÃ¤hlt)

**PROBLEM: Headers sind auswÃ¤hlbar! Whitespaces werden angezeigt!**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select preset                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ ğŸ–¥ï¸  System Presets          â† PROBLEM: AUSWÃ„HLBAR! âŒ    â”‚
â”‚      Desktop                  â† Whitespace davor sichtbar   â”‚
â”‚      Server                    â† Whitespace davor sichtbar â”‚
â”‚      Homelab Server            â† Whitespace davor sichtbar  â”‚
â”‚                                                              â”‚
â”‚    ğŸ¤– Device Presets           â† PROBLEM: AUSWÃ„HLBAR! âŒ    â”‚
â”‚      Jetson Nano               â† Whitespace davor sichtbar  â”‚
â”‚                                                              â”‚
â”‚  [Preview Window rechts]                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ Desktop                  â”‚                                â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                                â”‚
â”‚  â”‚ Base desktop environment â”‚                                â”‚
â”‚  â”‚ with GUI (Plasma)...     â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AKTUELLES VERHALTEN:
- Headers (ğŸ–¥ï¸ System Presets, ğŸ¤– Device Presets) sind AUSWÃ„HLBAR âŒ
- Whitespaces (  Desktop) werden in fzf angezeigt âŒ
- Wenn Header ausgewÃ¤hlt â†’ Error: "Cannot select category header"

SOLLTE SEIN:
- Headers NICHT auswÃ¤hlbar (nur visuell)
- Whitespaces sollten nicht sichtbar sein (oder sauber formatiert)
```

---

## ğŸ“º SCREEN 2B: Custom Install Feature Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select features (Space to select, Enter to confirm)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ ğŸ–¥ï¸  Desktop Environment      â† Header (auswÃ¤hlbar?)      â”‚
â”‚    âœ“ plasma                    â† Mit âœ“ markiert             â”‚
â”‚      gnome                                                      â”‚
â”‚      xfce                                                       â”‚
â”‚                                                              â”‚
â”‚    ğŸ“¦ Development               â† Header                      â”‚
â”‚      web-dev                                                    â”‚
â”‚      game-dev                                                   â”‚
â”‚      python-dev                                                 â”‚
â”‚      system-dev                                                 â”‚
â”‚                                                              â”‚
â”‚    ğŸ® Gaming & Media            â† Header                      â”‚
â”‚      streaming                                                  â”‚
â”‚      emulation                                                  â”‚
â”‚                                                              â”‚
â”‚    ğŸ³ Containerization          â† Header                      â”‚
â”‚      docker                                                      â”‚
â”‚      docker-rootless                                            â”‚
â”‚      podman                                                     â”‚
â”‚                                                              â”‚
â”‚    ğŸ’¾ Services                  â† Header                      â”‚
â”‚      database                                                    â”‚
â”‚      web-server                                                 â”‚
â”‚      mail-server                                                â”‚
â”‚                                                              â”‚
â”‚    ğŸ–¥ï¸  Virtualization            â† Header                      â”‚
â”‚      qemu-vm                                                    â”‚
â”‚      virt-manager                                               â”‚
â”‚                                                              â”‚
â”‚  [Preview Window rechts]                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Navigation: Space/Tab zum Toggle, Ctrl-A fÃ¼r All, Enter zum BestÃ¤tigen
```

---

## ğŸ“º SCREEN 2C: Advanced Options

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Advanced Options                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ ğŸ“ Load Profile from File                                 â”‚
â”‚    ğŸ“‹ Show Available Profiles                                â”‚
â”‚    ğŸ”„ Import from Existing Config                            â”‚
â”‚                                                              â”‚
â”‚  [Preview Window rechts]                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“º SCREEN 3A: Advanced â†’ Load Profile from File

```
â•â•â•â•â•â• Setup Mode â•â•â•â•â•â•
[INFO] Selected modules: ğŸ“ Load Profile from File

[INFO] Enter path to profile file:
  Examples:
  â€¢ profiles/fr4iser-home
  â€¢ /absolute/path/to/profile.nix
  â€¢ ~/my-config.nix

Profile path: _
```

---

## ğŸ“º SCREEN 3B: Advanced â†’ Show Available Profiles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Available Profiles (Select one to load)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ fr4iser-home                                             â”‚
â”‚    gira-home                                                 â”‚
â”‚    fr4iser-jetson                                            â”‚
â”‚                                                              â”‚
â”‚  [Preview Window rechts: zeigt Profile-Inhalt]              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“º SCREEN 4: Homelab Server Setup Flow

### 4.1: Admin Username (Text Input)

```
â•â•â•â•â•â• Homelab Configuration â•â•â•â•â•â•
Debug: Admin user set to: fr4iser

[?] Enter admin username [fr4iser]: _
```

---

### 4.2: Homelab Type Selection (fzf)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select homelab type                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ Single-Server                                             â”‚
â”‚    Multi-Server (Docker Swarm)                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Navigation: â†‘â†“ zum Navigieren, Enter zum BestÃ¤tigen
```

---

### 4.3: Swarm Role Selection (fzf) - nur wenn "Multi-Server" gewÃ¤hlt

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select Swarm role                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â–¶ Manager                                                   â”‚
â”‚    Worker                                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.4: Docker User Setup (Text Input)

**Nur wenn Single-Server gewÃ¤hlt wurde**

```
[?] Use separate user for Docker? (y/n) [n]: _
```

**Default:**
- `docker` (root) â†’ Default: `y` (Extra User empfohlen)
- `docker-rootless` â†’ Default: `n` (Main User OK)

---

### 4.5: Virtualization Username (Text Input)

**Nur wenn "Use separate user" = yes**

```
[?] Enter virtualization username(docker) [docker]: _
```

---

### 4.6: Virtualization Password (Text Input)

**Nur wenn "Use separate user" = yes**

```
[?] Enter password for virtualization user: _
```

---

### 4.7: Email Configuration (Text Input)

```
[?] Enter main email address [example@example.com]: _
```

---

### 4.8: Domain Configuration (Text Input)

```
[?] Enter domain name [example.com]: _
```

---

### 4.9: Desktop Enabled (Text Input)

```
[?] Enable desktop environment? (y/n) [n]: _
```

---

## ğŸ“º SCREEN 5: Custom Install â†’ Docker User Setup

**Nur wenn Docker-Feature ausgewÃ¤hlt wurde**

### 5.1: Docker User Setup Prompt

```
[?] Use separate user for Docker? (y/n) [y]: _
```

**Default basierend auf Docker-Mode:**
- `docker` â†’ Default: `y`
- `docker-rootless` â†’ Default: `n`

---

### 5.2: Virtualization Username (wenn "yes")

```
[?] Enter virtualization username(docker) [docker]: _
```

---

## ğŸ“º SCREEN 6: Deployment/Completion

```
â•â•â•â•â•â• Deployment â•â•â•â•â•â•
[INFO] Building NixOS configuration...
[INFO] Deploying...
[SUCCESS] Setup complete! ğŸ‰
```

---

## ğŸ”´ PROBLEME IDENTIFIZIERT

### Problem 1: Preset Selection Headers sind auswÃ¤hlbar
**Location:** `setup-mode.sh` Zeile 44-50

**Aktuell:**
- Headers (`ğŸ–¥ï¸  System Presets`, `ğŸ¤– Device Presets`) werden als normale Zeilen angezeigt
- Sie sind AUSWÃ„HLBAR in fzf
- Nach Auswahl â†’ Error: "Cannot select category header"

**LÃ¶sung:**
- Headers mit speziellem PrÃ¤fix markieren (z.B. `__HEADER__ğŸ–¥ï¸  System Presets`)
- Beim Parsen filtern: Wenn Auswahl mit `__HEADER__` beginnt â†’ Error
- ODER: Headers mit `--header-lines` ausblenden (geht nicht, da mehrere Header)

---

### Problem 2: Whitespaces werden in fzf angezeigt
**Location:** `setup-mode.sh` Zeile 31, 38

**Aktuell:**
- Presets werden mit `  $preset\n` hinzugefÃ¼gt (2 Spaces)
- Diese Whitespaces werden in fzf SICHTBAR angezeigt
- Nach Auswahl wird `sed 's/^  //'` verwendet, um sie zu entfernen

**Problem:**
- fzf zeigt die Whitespaces an â†’ sieht unprofessionell aus
- User sieht: `  Desktop` statt `Desktop`

**LÃ¶sung:**
- Headers mit PrÃ¤fix markieren, Presets OHNE Whitespace
- Beim Parsen: Header-PrÃ¤fix entfernen, Presets direkt verwenden

---

### Problem 3: Custom Install Headers sind auch auswÃ¤hlbar
**Location:** `setup-mode.sh` Zeile 196

**Aktuell:**
- Headers werden gefiltert mit: `if [[ ! "$choice" =~ ^[ğŸ–¥ï¸ğŸ“¦ğŸ®ğŸ³ğŸ’¾] ]]`
- Aber sie sind trotzdem in der Liste und AUSWÃ„HLBAR

**LÃ¶sung:**
- Gleiche LÃ¶sung wie bei Presets: Headers mit PrÃ¤fix markieren

---

## âœ… LÃ–SUNG: Headers mit PrÃ¤fix markieren

**Strategie:**
1. Headers mit `__HEADER__` PrÃ¤fix markieren
2. Presets OHNE Whitespace hinzufÃ¼gen
3. Beim Parsen: Headers filtern (wenn `__HEADER__` â†’ Error)
4. Presets direkt verwenden (kein `sed` nÃ¶tig)

**Beispiel:**
```bash
preset_list+="__HEADER__ğŸ–¥ï¸  System Presets\n"
for preset in "${SYSTEM_PRESETS[@]}"; do
    preset_list+="$preset\n"  # KEIN Whitespace!
done
```

**Beim Parsen:**
```bash
if [[ "$preset_choice" =~ ^__HEADER__ ]]; then
    log_error "Cannot select category header"
    return 1
fi
# Kein sed nÃ¶tig, da kein Whitespace!
```

