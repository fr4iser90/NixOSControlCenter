{{define "content"}}
<div class="container">
    <header>
        <h1>{{.T "modules.title"}}</h1>
        <p class="subtitle">{{.T "modules.subtitle"}}</p>
    </header>

    <div class="section">
        <div style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
            <input type="text" id="searchInput" placeholder="{{.T "modules.search"}}" 
                   style="flex: 1; min-width: 200px; padding: 12px; background: #1e1e1e; border: 1px solid #3e3e3e; border-radius: 4px; color: #d4d4d4; font-size: 1em;">
            <select id="categoryFilter" style="padding: 12px; background: #1e1e1e; border: 1px solid #3e3e3e; border-radius: 4px; color: #d4d4d4; cursor: pointer;">
                <option value="">{{.T "modules.filter.all_categories"}}</option>
                <option value="core">{{.T "modules.filter.core"}}</option>
                <option value="modules">{{.T "modules.filter.optional"}}</option>
            </select>
            <select id="statusFilter" style="padding: 12px; background: #1e1e1e; border: 1px solid #3e3e3e; border-radius: 4px; color: #d4d4d4; cursor: pointer;">
                <option value="">{{.T "modules.filter.all_status"}}</option>
                <option value="active">{{.T "modules.filter.active"}}</option>
                <option value="planned">{{.T "modules.filter.planned"}}</option>
            </select>
        </div>
        
        <div id="modulesGrid" class="modules-grid">
            <!-- Modules will be loaded here via JavaScript -->
        </div>
        
        <div id="noResults" style="display: none; text-align: center; padding: 40px; color: #858585;">
            {{.T "modules.no_results"}}
        </div>
    </div>
</div>

<style nonce="{{.Nonce}}">
    .modules-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .module-card {
        background: #1e1e1e;
        border: 1px solid #3e3e3e;
        border-radius: 8px;
        padding: 20px;
        transition: border-color 0.2s, transform 0.2s;
        cursor: pointer;
    }
    
    .module-card:hover {
        border-color: #4ec9b0;
        transform: translateY(-2px);
    }
    
    .module-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }
    
    .module-name {
        font-size: 1.3em;
        font-weight: bold;
        color: #4ec9b0;
        margin: 0;
    }
    
    .module-category {
        font-size: 0.85em;
        color: #858585;
        margin-top: 5px;
    }
    
    .status-badge {
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: bold;
    }
    
    .status-active {
        background: #1f2a2a;
        color: #4ec9b0;
        border: 1px solid #4ec9b0;
    }
    
    .status-planned {
        background: #2a2a1f;
        color: #f48771;
        border: 1px solid #f48771;
    }
    
    .module-description {
        color: #d4d4d4;
        margin: 15px 0;
        line-height: 1.6;
    }
    
    .module-features {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 15px 0;
    }
    
    .feature-badge {
        padding: 4px 8px;
        background: #252526;
        border: 1px solid #3e3e3e;
        border-radius: 4px;
        font-size: 0.8em;
        color: #858585;
    }
    
    .module-footer {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #3e3e3e;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .module-version {
        font-size: 0.85em;
        color: #858585;
    }
    
    .module-link {
        color: #4ec9b0;
        text-decoration: none;
        font-size: 0.9em;
    }
    
    .module-link:hover {
        text-decoration: underline;
    }
</style>

<script nonce="{{.Nonce}}">
    const modules = {{.ModulesJSON}};
    const translations = {
        no_results: "{{.T "modules.no_results"}}",
        view_details: "{{.T "modules.view_details"}}",
        version: "{{.T "modules.version"}}",
        features: {
            tui: "{{.T "modules.features.tui"}}",
            scripts: "{{.T "modules.features.scripts"}}",
            handlers: "{{.T "modules.features.handlers"}}",
            lib: "{{.T "modules.features.lib"}}"
        }
    };
    
    function renderModules(filteredModules) {
        const container = document.getElementById('modulesGrid');
        const noResults = document.getElementById('noResults');
        
        if (filteredModules.length === 0) {
            container.innerHTML = '';
            noResults.style.display = 'block';
            return;
        }
        
        noResults.style.display = 'none';
        container.innerHTML = filteredModules.map(module => {
            const features = [];
            if (module.has_tui) features.push(translations.features.tui);
            if (module.has_scripts) features.push(translations.features.scripts);
            if (module.has_handlers) features.push(translations.features.handlers);
            if (module.has_lib) features.push(translations.features.lib);
            
            const statusClass = module.status === 'active' ? 'status-active' : 'status-planned';
            const statusText = module.status === 'active' ? 'âœ… Active' : 'ðŸ“‹ Planned';
            
            return `
                <div class="module-card" onclick="window.location.href='/module/${escapeHtml(module.name)}'">
                    <div class="module-header">
                        <div>
                            <h3 class="module-name">ðŸ§© ${escapeHtml(module.name)}</h3>
                            <div class="module-category">${escapeHtml(module.category)}</div>
                        </div>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </div>
                    <p class="module-description">${escapeHtml(module.description)}</p>
                    ${features.length > 0 ? `
                        <div class="module-features">
                            ${features.map(f => `<span class="feature-badge">${f}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="module-footer">
                        <span class="module-version">${translations.version}: ${escapeHtml(module.version)}</span>
                        <a href="/module/${escapeHtml(module.name)}" class="module-link" onclick="event.stopPropagation();">${translations.view_details} â†’</a>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    function filterModules() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const category = document.getElementById('categoryFilter').value;
        const status = document.getElementById('statusFilter').value;
        
        const filtered = modules.filter(module => {
            const matchesSearch = !query || 
                module.name.toLowerCase().includes(query) ||
                module.description.toLowerCase().includes(query) ||
                module.category.toLowerCase().includes(query);
            
            const matchesCategory = !category || module.category.startsWith(category);
            const matchesStatus = !status || module.status === status;
            
            return matchesSearch && matchesCategory && matchesStatus;
        });
        
        renderModules(filtered);
    }
    
    document.getElementById('searchInput').addEventListener('input', filterModules);
    document.getElementById('categoryFilter').addEventListener('change', filterModules);
    document.getElementById('statusFilter').addEventListener('change', filterModules);
    
    // Initial render
    renderModules(modules);
</script>
{{end}}
