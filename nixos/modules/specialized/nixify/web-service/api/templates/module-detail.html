{{define "module-detail"}}
<div class="container">
    <header>
        <h1>üß© {{.Module.Name}}</h1>
        <p class="subtitle">{{.Module.Description}}</p>
    </header>

    <div class="section">
        <div class="module-info-grid">
            <div class="info-card">
                <h3>{{.T "modules.detail.category"}}</h3>
                <p>{{.Module.Category}}</p>
            </div>
            <div class="info-card">
                <h3>{{.T "modules.detail.version"}}</h3>
                <p>{{.Module.Version}}</p>
            </div>
            {{if .Module.ShowStatusBadge}}
            <div class="info-card">
                <h3>{{.T "modules.detail.status"}}</h3>
                <p>
                    {{if eq .Module.Status "active"}}
                        <span class="status-badge status-active">‚úÖ Active</span>
                    {{else if eq .Module.Status "disabled"}}
                        <span class="status-badge status-disabled">‚ùå Disabled</span>
                    {{else}}
                        <span class="status-badge status-planned">üìã Planned</span>
                    {{end}}
                </p>
            </div>
            {{end}}
            <div class="info-card">
                <h3>{{.T "modules.detail.github"}}</h3>
                <p><a href="{{.Module.GitHubURL}}" target="_blank" rel="noopener noreferrer" class="module-link">View on GitHub ‚Üí</a></p>
            </div>
        </div>
    </div>

    {{if .Module.Commands}}
    <div class="section">
        <h2>{{.T "modules.detail.commands"}}</h2>
        <div class="commands-list">
            {{range .Module.Commands}}
            <code class="command-item">{{.}}</code>
            {{end}}
        </div>
    </div>
    {{end}}

    {{if .Module.Assets}}
    <div class="section">
        <h2>{{.T "modules.detail.assets"}}</h2>
        <div class="assets-list">
            {{range .Module.Assets}}
            <span class="asset-badge">{{.}}</span>
            {{end}}
        </div>
    </div>
    {{end}}

    <div class="section">
        <h2>{{.T "modules.detail.structure"}}</h2>
        <div class="structure-info">
            <ul>
                <li>üìÑ <code>default.nix</code> - Main module entry point</li>
                <li>‚öôÔ∏è <code>options.nix</code> - Configuration options</li>
                {{if .Module.HasLib}}<li>üìö <code>lib/</code> - Library functions</li>{{end}}
                {{if .Module.HasScripts}}<li>üìú <code>scripts/</code> - CLI scripts</li>{{end}}
                {{if .Module.HasHandlers}}<li>üîß <code>handlers/</code> - Business logic</li>{{end}}
                {{if .Module.HasTUI}}<li>üñ•Ô∏è <code>tui/</code> - TUI components</li>{{end}}
                {{if .Module.Docs}}<li>üìö <code>doc/</code> - Documentation files</li>{{end}}
                {{if .Module.DocAssets}}<li>üñºÔ∏è <code>doc/assets/</code> - Documentation assets</li>{{end}}
                {{if .ReadmeContent}}<li>üìñ <code>README.md</code> - Main documentation</li>{{end}}
            </ul>
        </div>
    </div>

    {{if or .ReadmeContent .Module.Docs}}
    <div class="section">
        <h2>{{.T "modules.detail.documentation"}}</h2>
        
        {{if .Module.Docs}}
        <!-- Tab Navigation for multiple docs -->
        <div class="docs-tabs">
            {{range $index, $doc := .Module.Docs}}
            <button class="doc-tab {{if eq $index 0}}active{{end}}" onclick="showDoc('{{$doc.Name}}')">
                {{$doc.Title}}
            </button>
            {{end}}
            {{if .DefaultNixContent}}
            <button class="doc-tab" onclick="showDoc('code')">Code</button>
            {{end}}
        </div>
        
        <!-- Doc Content Panels -->
        {{range $index, $doc := .Module.Docs}}
        <div class="doc-panel {{if ne $index 0}}hidden{{end}}" id="doc-{{$doc.Name}}">
            <div class="doc-content">
                <pre><code>{{index $.DocContents $doc.Name}}</code></pre>
            </div>
        </div>
        {{end}}
        {{else if .ReadmeContent}}
        <!-- Single README without tabs -->
        <div class="doc-content">
            <pre><code>{{.ReadmeContent}}</code></pre>
        </div>
        {{end}}
        
        {{if .DefaultNixContent}}
        <div class="doc-panel hidden" id="doc-code">
            <div class="code-content">
                <pre><code class="language-nix">{{.DefaultNixContent}}</code></pre>
            </div>
        </div>
        {{end}}
    </div>
    {{end}}

    {{if .Module.DocAssets}}
    <div class="section">
        <h2>{{.T "modules.detail.doc_assets"}}</h2>
        <div class="doc-assets-grid">
            {{range .Module.DocAssets}}
            <div class="doc-asset-item">
                <img src="/module/{{$.Module.Name}}/asset/{{.}}" alt="{{.}}" 
                     onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');">
                <div class="doc-asset-fallback hidden">
                    <a href="/module/{{$.Module.Name}}/asset/{{.}}" target="_blank">{{.}}</a>
                </div>
            </div>
            {{end}}
        </div>
    </div>
    {{end}}
</div>

<script nonce="{{.Nonce}}">
    function showDoc(docName) {
        // Hide all panels
        document.querySelectorAll('.doc-panel').forEach(panel => {
            panel.classList.add('hidden');
        });
        
        // Remove active class from all tabs
        document.querySelectorAll('.doc-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Show selected panel
        const panel = document.getElementById('doc-' + docName);
        if (panel) {
            panel.classList.remove('hidden');
        }
        
        // Add active class to clicked tab
        event.target.classList.add('active');
    }
</script>
{{end}}
